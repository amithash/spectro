import os
import re
env = Environment()

env.Append(LIBS = ['m','pthread', 'decoder', 'spectgen', 'histdb'])
env.Append(LIBPATH = ['../lib/decoder', '../lib/spectgen', '../lib/histdb'])
env.Append(CPPPATH = ['../include'])
env.Append(CCFLAGS = ['-O3'])

install_programs = []
install_libs = []
prefix = '/usr'
bin_path = prefix + "/bin"
lib_path = prefix + "/lib"

# Let the programs know how much memory you have
for line in open('/proc/meminfo', 'r').read().split('\n'):
	if(not line.strip().find("MemTotal: ")):
		numbers = re.search("([0-9]+)", line.strip()).group(0)
		env.Append(CCFLAGS = '-DMEMORY_SIZE=' + numbers)

SPECTGEN_APP_SOURCES = [
	"spectgen_app.c"
]
install_programs += env.Program('spectgen', SPECTGEN_APP_SOURCES)

DECODER_APP_SOURCES = [
	"decoder_app.c"
]
install_programs += env.Program('decoder', DECODER_APP_SOURCES)

GENHISTDB_APP_SOURCES = [
	"genhistdb_app.c"
]
install_programs += env.Program('genhistdb', GENHISTDB_APP_SOURCES)

GETSIMILAR_SOURCES = [
	"getsimilar.c"
]
install_programs += env.Program('getsimilar', GETSIMILAR_SOURCES)

env.Alias('install', env.Install(bin_path, install_programs))
env.Alias('install', env.Install(lib_path, install_libs))

if 'uninstall' in COMMAND_LINE_TARGETS:
	env.Command("uninstall", None, Delete(FindInstalledFiles()))



