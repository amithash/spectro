CFLAGS=  -O3 -g -Wall -mssse3 -mfpmath=sse
LIBS = -lm -lpthread -lgcc_s -lfftw3f

TAGLIB_CFLAGS = `taglib-config --cflags`
TAGLIB_LIB = `taglib-config --libs`_c

FFTW_LIB = -lfftw3f

CFLAGS += $(TAGLIB_CFLAGS)


SPECT_OBJS = spect.o
SPECT2CSV_OBJS = spect2csv.o
HIST_OBJS = hist.o ceps.o
SPECT2HIST_OBJS = spect2hist.o
GENSPECTDB_OBJS = genspectdb.o
HIST2PGM_OBJS = hist2pgm.o
HIST_DIST_OBJS = hist_dist.o
GETSIMILAR_OBJS = getsimilar.o
SPECT2BSPECT_OBJS = spect2bspect.o
BSPECT_OBJS = bspect.o
TEST_OBJS  = test.o
BPM_OBJS = bpm.o
PLOTBPM_OBJS = plotbpm.o
PLOTHIST_OBJS = plothist.o

SPECT2CSV_EXE = spect2csv
GENSPECTDB_EXE = genspectdb
SPECT2HIST_EXE = spect2hist
HIST2PGM_EXE = hist2pgm
GETSIMILAR_EXE = getsimilar
PLOTBPM_EXE    = plotbpm
PLOTHIST_EXE = plothist

INSTALL_DIR = /usr/local/bin


all: spect2csv genspectdb spect2hist hist2pgm getsimilar plotbpm plothist

spect2csv: $(SPECT_OBJS) $(SPECT2CSV_OBJS)
	$(CC)  -o $(SPECT2CSV_EXE)  $(LIBS) $(SPECT_OBJS) $(SPECT2CSV_OBJS)

genspectdb: $(SPECT_OBJS) $(GENSPECTDB_OBJS)
	$(CC)  -o $(GENSPECTDB_EXE)  $(LIBS) $(SPECT_OBJS) $(GENSPECTDB_OBJS)

spect2hist: $(SPECT_OBJS) $(HIST_OBJS) $(SPECT2HIST_OBJS) $(BPM_OBJS)
	$(CC)  -o $(SPECT2HIST_EXE)  $(LIBS) $(TAGLIB_LIB) $(SPECT_OBJS) $(HIST_OBJS) $(SPECT2HIST_OBJS) $(BPM_OBJS)

hist2pgm: $(SPECT_OBJS) $(HIST_OBJS) $(HIST2PGM_OBJS) $(BPM_OBJS)
	$(CC)  -o $(HIST2PGM_EXE)  $(LIBS) $(TAGLIB_LIB) $(SPECT_OBJS) $(HIST_OBJS) $(HIST2PGM_OBJS) $(BPM_OBJS)

getsimilar: $(SPECT_OBJS) $(HIST_OBJS) $(HIST_DIST_OBJS) $(GETSIMILAR_OBJS) $(BPM_OBJS)
	$(CC)  -o $(GETSIMILAR_EXE)  $(LIBS) $(TAGLIB_LIB) $(SPECT_OBJS) $(HIST_OBJS) $(HIST_DIST_OBJS) $(GETSIMILAR_OBJS) $(BPM_OBJS)

plotbpm: $(SPECT_OBJS) $(BPM_OBJS) $(PLOTBPM_OBJS)
	$(CC) -o $(PLOTBPM_EXE) $(LIBS) $(TAGLIB_LIB) $(FFTW_LIB) $(SPECT_OBJS) $(PLOTBPM_OBJS) $(BPM_OBJS)

plothist: $(SPECT_OBJS) $(HIST_OBJS) $(PLOTHIST_OBJS) $(BPM_OBJS)
	$(CC) -o $(PLOTHIST_EXE) $(LIBS) $(TAGLIB_LIB) $(SPECT_OBJS) $(HIST_OBJS) $(PLOTHIST_OBJS) $(BPM_OBJS)

clean:
	rm -f $(SPECT2CSV_EXE) $(GENSPECTDB_EXE) $(SPECT2HIST_EXE) $(HIST2PGM_EXE)
	rm -f $(GETSIMILAR_EXE) $(PLOTBPM_EXE) $(PLOTHIST_EXE)
	rm -f $(SPECT2CSV_OBJS) $(SPECT_OBJS) $(GENSPECTDB_OBJS) $(SPECT2HIST_OBJS) $(BPM_OBJS)
	rm -f $(HIST_OBJS) $(HIST2PGM_OBJS) $(HIST_DIST_OBJS) $(GETSIMILAR_OBJS) $(PLOTBPM_OBJS)
	rm -f $(PLOTHIST_OBJS)

install:
	cp --target-directory $(INSTALL_DIR) $(SPECT2CSV_EXE) $(GENSPECTDB_EXE) $(SPECT2HIST_EXE) $(HIST2PGM_EXE) $(GETSIMILAR_EXE)
uninstall:
	rm -f $(INSTALL_DIR)/$(SPECT2CSV_EXE)
	rm -f $(INSTALL_DIR)/$(GENSPECTDB_EXE)
	rm -f $(INSTALL_DIR)/$(SPECT2HIST_EXE)
	rm -f $(INSTALL_DIR)/$(HIST2PGM_EXE)
	rm -f $(INSTALL_DIR)/$(GETSIMILAR_EXE)

